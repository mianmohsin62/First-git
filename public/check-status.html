<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Check Repair Status - Fahad Electric Store & Electronics</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <h1>âš¡ Fahad Electric Store & Electronics</h1>
          <p class="urdu">ÙÛØ¯ Ø§Ù„ÛŒÚ©Ù¹Ø±Ú© Ø§Ø³Ù¹ÙˆØ± Ø§ÛŒÙ†Úˆ Ø§Ù„ÛŒÚ©Ù¹Ø±Ø§Ù†Ú©Ø³</p>
        </div>
        <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
        <nav>
          <ul id="navMenu">
            <li><a href="/">Home / ÛÙˆÙ…</a></li>
            <li><a href="/about">About / ØªØ¹Ø§Ø±Ù</a></li>
            <li><a href="/services">Services / Ø®Ø¯Ù…Ø§Øª</a></li>
            <li><a href="/check-status">Check Status / Ø­Ø§Ù„Øª Ø¯ÛŒÚ©Ú¾ÛŒÚº</a></li>
            <li><a href="/contact">Contact / Ø±Ø§Ø¨Ø·Û</a></li>
            <li><a href="/admin">Admin</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h2>Check Repair Status</h2>
      <p class="urdu">Ù…Ø±Ù…Øª Ú©ÛŒ Ø­Ø§Ù„Øª Ú†ÛŒÚ© Ú©Ø±ÛŒÚº</p>
      <p>Track your device repair progress online</p>
    </div>
  </section>

  <section style="padding: 4rem 0;">
    <div class="container">
      <div style="max-width: 600px; margin: 0 auto;">
        <div class="card">
          <h2 style="color: var(--primary-color); margin-bottom: 1.5rem; text-align: center;">
            Track Your Repair
            <span class="urdu" style="display: block; font-size: 1rem; margin-top: 0.5rem;">Ø§Ù¾Ù†ÛŒ Ù…Ø±Ù…Øª Ú©Ùˆ Ù¹Ø±ÛŒÚ© Ú©Ø±ÛŒÚº</span>
          </h2>

          <div id="alertContainer"></div>

          <form id="statusCheckForm">
            <div class="form-group">
              <label>Search By / ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</label>
              <select id="searchType" class="form-control">
                <option value="jobId">Job ID / Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ</option>
                <option value="phone">Phone Number / ÙÙˆÙ† Ù†Ù…Ø¨Ø±</option>
              </select>
            </div>

            <div class="form-group" id="jobIdGroup">
              <label for="jobId">
                Job ID / Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ
                <span style="color: var(--danger-color);">*</span>
              </label>
              <input type="text" id="jobId" placeholder="e.g., FE123456789" required>
              <small style="color: var(--text-color);">Enter the Job ID provided when you submitted your device</small>
              <p class="urdu" style="font-size: 0.9rem; margin-top: 0.5rem;">Ø¬Ø¨ Ø¢Ù¾ Ù†Û’ Ø§Ù¾Ù†Ø§ Ø¢Ù„Û Ø¬Ù…Ø¹ Ú©Ø±Ø§ÛŒØ§ ØªÙˆ Ø¯ÛŒ Ú¯Ø¦ÛŒ Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</p>
            </div>

            <div class="form-group hidden" id="phoneGroup">
              <label for="phone">
                Phone Number / ÙÙˆÙ† Ù†Ù…Ø¨Ø±
                <span style="color: var(--danger-color);">*</span>
              </label>
              <input type="tel" id="phone" placeholder="e.g., 03017123035">
              <small style="color: var(--text-color);">Enter the phone number you provided during submission</small>
              <p class="urdu" style="font-size: 0.9rem; margin-top: 0.5rem;">ÙˆÛ ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº Ø¬Ùˆ Ø¢Ù¾ Ù†Û’ Ø¬Ù…Ø¹ Ú©Ø±Ø§ØªÛ’ ÙˆÙ‚Øª ÙØ±Ø§ÛÙ… Ú©ÛŒØ§ ØªÚ¾Ø§</p>
            </div>

            <button type="submit" class="btn btn-primary btn-block">
              ğŸ” Check Status / Ø­Ø§Ù„Øª Ø¯ÛŒÚ©Ú¾ÛŒÚº
            </button>
          </form>
        </div>

        <div id="resultsContainer" class="hidden"></div>

        <div class="card" style="margin-top: 2rem; background: #eff6ff;">
          <h3 style="color: var(--primary-color); margin-bottom: 1rem;">
            Need Help?
            <span class="urdu" style="display: block; font-size: 0.9rem; margin-top: 0.3rem;">Ù…Ø¯Ø¯ Ú†Ø§ÛÛŒÛ’ØŸ</span>
          </h3>
          <ul style="margin-left: 1.5rem; line-height: 1.8;">
            <li>Can't find your Job ID? Check the receipt we gave you when you submitted your device.</li>
            <li>Lost your receipt? Contact us with your phone number and device details.</li>
            <li>Multiple devices? Each device has a unique Job ID.</li>
          </ul>
          <ul class="urdu" style="margin-right: 1.5rem; line-height: 1.8; margin-top: 1rem; direction: rtl;">
            <li>Ø§Ù¾Ù†ÛŒ Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ Ù†ÛÛŒÚº Ù…Ù„ Ø±ÛÛŒØŸ ÙˆÛ Ø±Ø³ÛŒØ¯ Ú†ÛŒÚ© Ú©Ø±ÛŒÚº Ø¬Ùˆ ÛÙ… Ù†Û’ Ø¢Ù¾ Ú©Ùˆ Ø¢Ù¾ Ú©Ø§ Ø¢Ù„Û Ø¬Ù…Ø¹ Ú©Ø±Ø§Ù†Û’ Ù¾Ø± Ø¯ÛŒ ØªÚ¾ÛŒÛ”</li>
            <li>Ø±Ø³ÛŒØ¯ Ú¯Ù… ÛÙˆ Ú¯Ø¦ÛŒØŸ Ø§Ù¾Ù†Û’ ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ø§ÙˆØ± Ø¢Ù„Û’ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª Ú©Û’ Ø³Ø§ØªÚ¾ ÛÙ… Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚºÛ”</li>
            <li>Ù…ØªØ¹Ø¯Ø¯ Ø¢Ù„Ø§ØªØŸ ÛØ± Ø¢Ù„Û’ Ú©ÛŒ Ø§ÛŒÚ© Ù…Ù†ÙØ±Ø¯ Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ ÛÛ’Û”</li>
          </ul>
          <div style="text-align: center; margin-top: 1.5rem;">
            <a href="/contact" class="btn btn-secondary">Contact Us / ÛÙ… Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>&copy; 2024 Fahad Electric Store & Electronics. All rights reserved.</p>
      <p class="urdu">ÙÛØ¯ Ø§Ù„ÛŒÚ©Ù¹Ø±Ú© Ø§Ø³Ù¹ÙˆØ± Ø§ÛŒÙ†Úˆ Ø§Ù„ÛŒÚ©Ù¹Ø±Ø§Ù†Ú©Ø³</p>
      <p style="margin-top: 1rem;">Defense Road, Mohala Rasheed Park, Jaranwala</p>
      <p>ğŸ“± +92 301 7123035 | ğŸ“ +92 303 6279532</p>
    </div>
  </footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('navMenu');
      menu.classList.toggle('active');
    }

    const searchType = document.getElementById('searchType');
    const jobIdGroup = document.getElementById('jobIdGroup');
    const phoneGroup = document.getElementById('phoneGroup');
    const form = document.getElementById('statusCheckForm');
    const alertContainer = document.getElementById('alertContainer');
    const resultsContainer = document.getElementById('resultsContainer');

    searchType.addEventListener('change', function() {
      if (this.value === 'jobId') {
        jobIdGroup.classList.remove('hidden');
        phoneGroup.classList.add('hidden');
        document.getElementById('jobId').required = true;
        document.getElementById('phone').required = false;
      } else {
        jobIdGroup.classList.add('hidden');
        phoneGroup.classList.remove('hidden');
        document.getElementById('jobId').required = false;
        document.getElementById('phone').required = true;
      }
    });

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const searchBy = searchType.value;
      const jobId = document.getElementById('jobId').value.trim();
      const phone = document.getElementById('phone').value.trim();

      alertContainer.innerHTML = '';
      resultsContainer.innerHTML = '';
      resultsContainer.classList.add('hidden');

      try {
        const response = await fetch('/api/check-status', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            jobId: searchBy === 'jobId' ? jobId : null,
            phone: searchBy === 'phone' ? phone : null
          })
        });

        const data = await response.json();

        if (!response.ok) {
          showAlert(data.error || 'Unable to find repair records', 'error');
          return;
        }

        displayResults(data);
      } catch (error) {
        showAlert('Error connecting to server. Please try again.', 'error');
      }
    });

    function showAlert(message, type) {
      const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
      alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
    }

    function displayResults(jobs) {
      if (!jobs || jobs.length === 0) {
        showAlert('No repair records found', 'error');
        return;
      }

      let html = '';
      
      jobs.forEach(job => {
        const statusClass = job.repair_status.toLowerCase().replace(/\s+/g, '-');
        const paymentClass = job.payment_status.toLowerCase();
        
        html += `
          <div class="card" style="margin-top: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
              <div>
                <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Job ID: ${job.job_id}</h3>
                <p class="urdu">Ø¬Ø§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ: ${job.job_id}</p>
              </div>
              <div style="text-align: right;">
                <span class="badge badge-${statusClass}">${job.repair_status}</span>
                <span class="badge badge-${paymentClass}" style="margin-left: 0.5rem;">${job.payment_status}</span>
              </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
              <div>
                <strong>Customer Name / Ù†Ø§Ù…:</strong>
                <p>${job.customer_name}</p>
              </div>
              <div>
                <strong>Phone / ÙÙˆÙ†:</strong>
                <p>${job.customer_phone}</p>
              </div>
              <div>
                <strong>Item Type / Ø¢Ù„Û’ Ú©ÛŒ Ù‚Ø³Ù…:</strong>
                <p>${job.item_type}</p>
              </div>
              ${job.brand_model ? `
              <div>
                <strong>Brand/Model / Ø¨Ø±Ø§Ù†Úˆ/Ù…Ø§ÚˆÙ„:</strong>
                <p>${job.brand_model}</p>
              </div>
              ` : ''}
            </div>

            <div style="margin-top: 1.5rem; padding: 1rem; background: var(--light-color); border-radius: 0.375rem;">
              <strong>Problem Description / Ù…Ø³Ø¦Ù„Û’ Ú©ÛŒ ØªÙØµÛŒÙ„:</strong>
              <p style="margin-top: 0.5rem;">${job.problem_description}</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
              <div>
                <strong>Received Date / Ù…ÙˆØµÙˆÙ„ ÛÙˆÙ†Û’ Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</strong>
                <p>${new Date(job.received_date).toLocaleDateString()}</p>
              </div>
              ${job.expected_completion ? `
              <div>
                <strong>Expected Completion / Ù…ØªÙˆÙ‚Ø¹ ØªÚ©Ù…ÛŒÙ„:</strong>
                <p>${new Date(job.expected_completion).toLocaleDateString()}</p>
              </div>
              ` : ''}
              ${job.delivery_date ? `
              <div>
                <strong>Delivery Date / ÚˆÛŒÙ„ÛŒÙˆØ±ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ®:</strong>
                <p>${new Date(job.delivery_date).toLocaleDateString()}</p>
              </div>
              ` : ''}
              <div>
                <strong>Repair Cost / Ù…Ø±Ù…Øª Ú©ÛŒ Ù„Ø§Ú¯Øª:</strong>
                <p style="font-size: 1.25rem; color: var(--primary-color); font-weight: bold;">Rs. ${job.repair_cost || '0'}</p>
              </div>
            </div>

            ${job.technician_notes ? `
            <div style="margin-top: 1.5rem; padding: 1rem; background: #fffbeb; border-radius: 0.375rem; border-left: 4px solid var(--warning-color);">
              <strong>Technician Notes / Ù¹ÛŒÚ©Ù†ÛŒØ´Ù† Ù†ÙˆÙ¹Ø³:</strong>
              <p style="margin-top: 0.5rem;">${job.technician_notes}</p>
            </div>
            ` : ''}

            ${job.repair_status === 'Completed' || job.repair_status === 'Delivered' ? `
            <div style="margin-top: 1.5rem; padding: 1rem; background: #d1fae5; border-radius: 0.375rem; text-align: center;">
              <p style="color: #065f46; font-weight: 600;">
                âœ… Your device is ready for collection!<br>
                <span class="urdu">Ø¢Ù¾ Ú©Ø§ Ø¢Ù„Û Ù„ÛŒÙ†Û’ Ú©Û’ Ù„ÛŒÛ’ ØªÛŒØ§Ø± ÛÛ’!</span>
              </p>
            </div>
            ` : ''}

            <div style="text-align: center; margin-top: 1.5rem;">
              <a href="/contact" class="btn btn-secondary">Contact Workshop / ÙˆØ±Ú©Ø´Ø§Ù¾ Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚº</a>
            </div>
          </div>
        `;
      });

      resultsContainer.innerHTML = html;
      resultsContainer.classList.remove('hidden');
      showAlert('Repair records found successfully!', 'success');
    }
  </script>
</body>
</html>
